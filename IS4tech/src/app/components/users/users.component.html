<script
  src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
  integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
  crossorigin="anonymous"
></script>

<div>
  <div class="row">
    <!--Area de funcionalidad-->
    <div class="col-sm p-3 min-vh-100 dimen" style="max-width: 24rem">
      <div>
        <h1 class="title">Usuarios</h1>
        <br />

        <!--Buscador-->
        <div class="input-group rounded" style="max-width: 20rem">
          <input
            type="Buscar"
            class="form-control rounded"
            placeholder="Buscar"
            aria-label="Buscar"
            aria-describedby="search-addon"
            [(ngModel)]="search"
          />
          <span class="input-group-text border-0" id="search-addon">
            <mat-icon>search</mat-icon>
          </span>
        </div>
        <br />
      </div>
      <div><em (click)="filter()" class="fa-solid fa-sort filt"></em></div>

      <div class="card" *ngFor="let user of users | search: search">
        <div class="card-body hoved" (click)="findById(user.id)">
          <em
            *ngIf="user.status == 1"
            class="fa-solid fa-circle text-success"
          ></em>
          <em
            *ngIf="user.status == 0"
            class="fa-solid fa-circle text-secondary"
          ></em>
          {{ user.name }}
        </div>
      </div>
      <div class="flex-container">
        <em
          class="back bacc"
          (click)="goBack()"
          class="fas fa-angle-double-left fa-2x"
          style="color: #12579c"
        ></em>
        <em
          class="ahead bacc"
          (click)="goAhead()"
          class="fas fa-angle-double-right fa-2x"
          style="color: #12579c"
        ></em>
      </div>
    </div>
    <div class="col-sm p-3 min-vh-100 dim2">
      <div class="card border-primary">
        <div class="card-body">
          <!--Titulos y nombres-->

          <p class="coll">Editar</p>
          <mat-slide-toggle
            name="status"
            #status="ngModel"
            [(ngModel)]="getUser.status"
            class="slide"
            *ngIf="getUser.name && getUser.email"
          >
            <div *ngIf="getUser.status == 1">Activo</div>
            <div *ngIf="getUser.status == 0">Inactivo</div>
          </mat-slide-toggle>
          <br /><br />

            <div class="container card-0">
              <div class="row">
                <div class="col-sm-6">
                  <mat-form-field class="other" appearance="outline">
                    <mat-label>Nombre</mat-label>
                    <mat-label *ngIf="!name.valid && name.touched">
                      requerido</mat-label
                    >
                    <input
                      [disabled]="!getUser.name"
                      #name="ngModel"
                      [(ngModel)]="getUser.name"
                      matInput
                      placeholder="Nombre"
                      name="nombre"
                      required="true"
                    />
                  </mat-form-field>
                  <mat-form-field class="" appearance="outline">
                    <mat-label>Correo</mat-label>
                    <mat-label *ngIf="!name.valid && name.touched">
                      requerido</mat-label
                    >
                    <input
                      [disabled]="!getUser.email"
                      #email="ngModel"
                      [(ngModel)]="getUser.email"
                      matInput
                      placeholder="Email"
                      name="email"
                      required="true"
                    />
                  </mat-form-field>
                </div>

                <div class="col-sm-6">
                  <div *ngIf="this.editProfile == true">
                    <em
                      (click)="goBackProfiles()"
                      class="back"
                      class="fas fa-angle-double-left fa-2x heed2, top-right"
                      style="color: #12579c"
                    ></em>
                    <em
                      class="ahead"
                      (click)="goAheadProfiles()"
                      class="fas fa-angle-double-right fa-2x heed, top-right"
                      style="color: #12579c"
                    ></em>
                  </div>
                  <div class="col-sm-6 fort" style="float: left">
                    <mat-form-field
                      appearance="outline"
                      *ngIf="this.editProfile == false"
                    >
                      <mat-label>Mi perfil</mat-label>
                      <select
                        matNativeControl
                        name="profile"
                        #profile="ngModel"
                        [(ngModel)]="getUser.profile"
                      >
                        <option
                          [disabled]="true"
                          [value]="myProfile.id"
                          [selected]="myProfile.name"
                        >
                          {{ myProfile.name }}
                        </option>
                      </select>
                    </mat-form-field>
                    <mat-form-field
                      appearance="fill"
                      *ngIf="this.editProfile == true"
                    >
                      <mat-label>Mi perfil</mat-label>
                      <select
                        matNativeControl
                        name="profile"
                        #profile="ngModel"
                        [(ngModel)]="getUser.profile"
                      >
                        <option
                          *ngFor="let profile of profiles"
                          [value]="profile.id"
                        >
                          {{ profile.name }}
                        </option>
                      </select>
                    </mat-form-field>
                  </div>
                </div>
              </div>
          </div>
          <div>
            <p class="dragd">Asignaci√≥n de empresas</p>
          </div>
          <br />
          <div class="row" *ngIf="this.editEnterprises == true">
            <div cdkDropListGroup>
              <!--OTRO DRAG-->
              <div class="example-container">
                <div
                  cdkDropList
                  [cdkDropListData]="listNumbers1"
                  [cdkDropListConnectedTo]="[ln2]"
                  class="example-list"
                  (cdkDropListDropped)="drop($event)"
                >
                  <div
                    class="example-box"
                    *ngFor="let n of listNumbers1"
                    cdkDrag
                  >
                    {{ n.name }}
                  </div>
                </div>
                <div class="flex-container">
                  <div>
                    <em
                      class="back"
                      (click)="goBackEnterprise()"
                      class="fas fa-angle-double-left fa-2x drag1"
                      style="color: #12579c"
                    ></em>
                  </div>
                  <div>
                    <em
                      class="ahead"
                      (click)="goAheadEnterprise()"
                      class="fas fa-angle-double-right fa-2x drag2"
                      style="color: #12579c"
                    ></em>
                  </div>
                </div>

                <button
                  (click)="addEnterprise()"
                  type="button"
                  class="btn btn-primary botdrag"
                >
                  Agregar Empresa
                </button>
              </div>

              <!--OTRO DRAG-->
              <div class="example-container">
                <div
                  cdkDropList
                  [cdkDropListData]="empresas"
                  [cdkDropListConnectedTo]="[ln1]"
                  class="example-list"
                  (cdkDropListDropped)="drop($event)"
                >
                  <div
                    class="example-box"
                    *ngFor="
                      let n of empresas;
                      paginate: {
                        id: 'empresas',
                        itemsPerPage: 3,
                        currentPage: p
                      }
                    "
                    cdkDrag
                  >
                    {{ n.name }}
                  </div>
                </div>
                <pagination-controls
                  id="empresas"
                  (pageChange)="p = $event"
                  responsive="true"
                  previousLabel="Previous"
                  nextLabel="Next"
                >
                </pagination-controls>
              </div>
            </div>
          </div>
          <div class="row" *ngIf="this.editEnterprises == false">
            <div cdkDropListGroup>
              <!--OTRO DRAG-->
              <div class="example-container">
                <div
                  cdkDropList
                  [cdkDropListData]="listNumbers1"
                  [cdkDropListConnectedTo]="[ln2]"
                  class="example-list"
                  (cdkDropListDropped)="drop($event)"
                >
                  <div
                    cdkDragDisabled
                    class="example-box"
                    *ngFor="let n of listNumbers1"
                    cdkDrag
                  >
                    {{ n.name }}
                  </div>
                </div>
                <div class="flex-container">
                  <div>
                    <em
                      class="back"
                      (click)="goBackEnterprise()"
                      class="fas fa-angle-double-left fa-2x drag1"
                      style="color: #12579c"
                    ></em>
                  </div>
                  <div>
                    <em
                      class="ahead"
                      (click)="goAheadEnterprise()"
                      class="fas fa-angle-double-right fa-2x drag2"
                      style="color: #12579c"
                    ></em>
                  </div>
                </div>

                <button
                  (click)="addEnterprise()"
                  type="button"
                  class="btn btn-primary botdrag"
                >
                  Agregar Empresa
                </button>
              </div>

              <!--OTRO DRAG-->
              <div class="example-container">
                <div
                  cdkDropList
                  [cdkDropListData]="getUser.empresas"
                  [cdkDropListConnectedTo]="[ln1]"
                  class="example-list"
                  (cdkDropListDropped)="drop($event)"
                >
                  <div
                    cdkDragDisabled
                    class="example-box"
                    *ngFor="
                      let n of getUser.empresas
                        | paginate
                          : {
                              id: 'empresas',
                              itemsPerPage: 4,
                              currentPage: p
                            }
                    "
                    cdkDrag
                  >
                    {{ n.enterpriseName }}
                    <div (click)="deleteUserEnterprise(n.id,n.enterpriseName,n.userId)" class="forev"><mat-icon class="dragg">delete_forever</mat-icon></div>
                  </div>
                </div>
                <pagination-controls
                  id="empresas"
                  (pageChange)="p = $event"
                  responsive="true"
                  previousLabel="Previous"
                  nextLabel="Next"
                >
                </pagination-controls>
              </div>
            </div>
          </div>

          <div class="flex-container">
            <button
              (click)="putProfile(getUser.id)"
              [disabled]="!name.valid || !email.valid"
              type="button"
              class="btn btn-primary butt2"
            >
              Guardar
            </button>
            <button
              (click)="cambiarPerfil()"
              [disabled]="!name.valid || !email.valid"
              type="button"
              class="btn btn-primary butt3"
            >
              Cambiar perfil
            </button>
            <button
              (click)="asignarEmpresas()"
              [disabled]="!name.valid || !email.valid"
              type="button"
              class="btn btn-primary asignEnt"
            >
              Asignarme empresas
            </button>
            <button
              mat-mini-fab
              color="black"
              type="button"
              class="btn btn-primary butt"
              (click)="openDialog()"
            >
              <mat-icon>note_add</mat-icon>
            </button>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
